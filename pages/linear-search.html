<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Linear search — Visualization</title>
  <link rel="stylesheet" href="../css/common.css">
  <style>
    .viz { display: flex; flex-wrap: wrap; align-items: center; gap: 0.5rem; min-height: 100px; padding: 1rem; background: #24283b; border-radius: 12px; }
    .cell { width: 52px; height: 44px; display: inline-flex; flex-direction: column; align-items: center; justify-content: center; background: #414868; border-radius: 8px; border: 2px solid #565f89; font-weight: 700; color: #7dcfff; transition: all 0.2s; }
    .cell .idx { font-size: 0.7rem; color: #565f89; }
    .cell.current { border-color: #7dcfff; box-shadow: 0 0 14px rgba(125,207,255,0.6); background: #364a7c; }
    .cell.found { border-color: #9ece6a; box-shadow: 0 0 12px rgba(158,206,106,0.5); }
    .cell.visited { border-color: #565f89; opacity: 0.85; }
  </style>
</head>
<body>
  <h1>Linear search</h1>
  <p class="subtitle">Step-by-step: current index highlighted and pseudocode shown for each step.</p>
  <div class="controls">
    <input type="text" id="target" placeholder="Target value" style="width:120px">
    <button onclick="search()">Search</button>
    <button class="danger" id="btnClear" onclick="clearAll()">Clear</button>
  </div>
  <div class="controls">
    <span style="color:#565f89">Size:</span>
    <input type="number" id="rndSize" min="1" max="20" value="10" style="width:60px">
    <button onclick="randomArr()">Generate array</button>
  </div>
  <div class="controls playback-row">
    <span class="playback-label">Playback:</span>
    <label><input type="radio" name="playback" id="modeAutoplay" checked> Autoplay</label>
    <label><input type="radio" name="playback" id="modeStep"> Step by step</label>
    <button type="button" id="btnNextStep" disabled>Next step</button>
  </div>
  <div id="log">Operations and pseudocode appear here.</div>
  <div class="viz" id="viz"></div>

  <script src="../js/common-viz.js"></script>
  <script>
    (function () {
      var arr = [];
      var animating = false;
      function setBtns(on) { animating = !on; document.querySelectorAll('.controls button:not(#btnClear):not(#btnNextStep)').forEach(function (b) { b.disabled = !on; }); var nb = document.getElementById('btnNextStep'); if (nb) nb.disabled = on || window.VizCommon.getAutoplay(); }
      function showPseudo(lines, active, msg) { window.VizCommon.showPseudo(lines, active, msg); }
      function step() { return window.VizCommon.step(); }
      window.VizCommon.setupPlayback(900, function () { return animating; }, setBtns);
      function render(currentIdx, visited, foundIdx) {
        if (currentIdx === undefined) currentIdx = -1;
        if (visited === undefined) visited = [];
        if (foundIdx === undefined) foundIdx = -1;
        var v = document.getElementById('viz');
        v.innerHTML = '';
        v.appendChild(Object.assign(document.createElement('span'), { className: 'label', textContent: 'arr' }));
        for (var i = 0; i < arr.length; i++) {
          var c = document.createElement('div');
          c.className = 'cell';
          if (i === foundIdx) c.classList.add('found');
          else if (i === currentIdx) c.classList.add('current');
          else if (visited.indexOf(i) !== -1) c.classList.add('visited');
          c.dataset.index = i;
          c.innerHTML = '<span class="idx">' + i + '</span>' + arr[i];
          v.appendChild(c);
        }
        if (arr.length === 0) v.appendChild(document.createTextNode('(empty)'));
      }
      var P_SEARCH = [
      '// Linear search — O(n)',
      'for i = 0 to length - 1:',
      '  if arr[i] == target: return i',
      'return -1   // not found'
    ];
      async function search() {
      var t = document.getElementById('target').value.trim();
      if (t === '') { showPseudo([], -1, 'Enter a target value.'); return; }
      var target = isNaN(Number(t)) ? t : Number(t);
      if (arr.length === 0) { showPseudo([], -1, 'Generate an array first.'); return; }
      setBtns(false);
      var visited = [];
      showPseudo(P_SEARCH, 0, 'Linear search for ' + target + '.'); render();
      await step();
      for (var i = 0; i < arr.length; i++) {
        showPseudo(P_SEARCH, 1, 'i = ' + i + '.'); render(i, visited);
        await step();
        showPseudo(P_SEARCH, 2, 'arr[' + i + '] == ' + target + '? ' + (arr[i] == target ? 'Yes.' : 'No.'));
        render(i, visited);
        await step();
        if (arr[i] == target) {
          showPseudo(P_SEARCH, 2, 'Found at index ' + i + '.'); render(i, visited, i);
          setBtns(true);
          return;
        }
        visited.push(i);
      }
      showPseudo(P_SEARCH, 3, 'Not found. return -1'); render(-1, visited);
      setBtns(true);
      }
      function clearAll() { arr = []; render(); showPseudo([], -1, 'Cleared.'); }
      function randomArr() {
        var n = Math.min(20, Math.max(1, parseInt(document.getElementById('rndSize').value, 10) || 10));
        arr = []; for (var i = 0; i < n; i++) arr.push(Math.floor(Math.random() * 99) + 1);
        render(); showPseudo([], -1, 'Array of ' + n + ' elements.');
      }
      render();
      window.search = search;
      window.clearAll = clearAll;
      window.randomArr = randomArr;
    })();
  </script>
</body>
</html>
